{% extends 'polls/base.html' %}
{% load static %}_
{% block content %}
    {% csrf_token %}
    {% if get_user_names %}
      {% for key, val in get_user_names%} 
        {%if key == "runname" %}
        <div class="row row-space-2 margin-b-4">
          <div class="col-sm-8 col-sm-offset-2">
              <div class="panel panel-default">
                <div class="panel-heading">Fill the <b>user name</b> and the <b>Used Library Kit</b> for each project in the run {{ val }} </div>
                <div class="panel-body"> This is the second, and the last, FORM that user need to fill down to have the information about the run<BR>
                 Once the name of the user and the libray Kit used in the run, were filled and submited, the next page will show the link to download the files
                 that can be used to import to illumina Base Space  
                 </div> <!--  end of panel body -->
              </div> <!--  end of panel  -->
           </div> <!--  end of col-sm-8 -->
        </div> <!--  end of row -->
        {%endif%}
      {% endfor %} 
      <div class="row row-space-2 margin-b-4">
        <div class="col-sm-8 col-sm-offset-2">
            <p>The following information have been collected from the Sample Sheet uploaded previously.<br>
            It contains the userid information. Correct in the user name field if this information need to be changed</p>
            <p>Write down the Library kit used for each project</p>
        </div> <!--// end col-sm-8  -->
    </div> <!--// end row -->
    
    <!-- Prepare the FORM for step 2 -->
    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-8" >
        <div class="panel panel-default">
          <div class="panel-heading">Form to upload the Sample Sheet file</div>
          <div class="panel-body">
            <form method="post" enctype="multipart/form-data"name="getSample2" id="getSample2" class="form-horizontal">
            {% csrf_token %}
                <input type="hidden"name="action" value="displayResult"/>
                    {% for key, values in get_user_names %}
                      {% if key != 'runname'%}  
                         <div class="form-group required">
                             <label class="col-sm-10" for="project">Project name : {{ key }}</label><br>
                               <input type="hidden" name="project" value="{{key}}"/>
                             <label class="col-sm-4 control-label"<label for="username" >User name : </label>
                            <div class="col-sm-6"><input class="form-control" type="text" name="username" size="60" maxlength="50" value="{{ values }}"></div>
                            <label class="col-sm-4 control-label for="libkit" >UsedLibrary Kit : </label>
                             <div class="col-sm-6"><input class="form-control" type="text" name="librarykit" size="60" maxlength="50"></div>
                            <br><br>
                         </div>                       
                      {% else %}
                        <input type="hidden" name="runname" value="{{values}}"/>
                      {%endif%}
                    {% endfor %}
                    <br>
                    <br>
                    <input class="btn pull-right btn-primary" type="submit" value="Submit">
                </div>
          </form>
          
          <p> Fields marked with <FONT COLOR= "Red">*</FONT> are mandatory</p>
          
    {% elif uploaded_file_url %}
        <p>File uploaded at: <a href="{{ uploaded_file_url}}"download>{{ uploaded_file_url  }}</a></p>
        <p>{{ field }} <a href="{{ uploaded_file_url }}" download>{{ uploaded_file_url|cut:"documents/" }}<span class="glyphicon glyphicon-download-alt"></span></a></p>
                    
    {% elif completed_form %}
        {% csrf_token %}
        {% for key, val in completed_form%} 
          {%if key == "runname" %}
             <div class="row row-space-2 margin-b-4">
               <div class="col-sm-8 col-sm-offset-2">
                 <div class="panel panel-default">
                   <div class="panel-heading"><b>Run configuration have been sucessfully stored</b><BR>For the run name : <b>{{ val }} </b></div>
                   <div class="panel-body"> All the required information is stored now on database. <BR>
                    The files to be imported to Illumina Base Space that can be downloaded in the links below  
                    </div> <!--  end of panel body -->
                </div> <!--  end of panel  -->
             </div> <!--  end of col-sm-8 -->
           </div> <!--  end of row -->
        {%endif%}
        {% endfor %} 
        
        {% for key, values in completed_form %}
          {% if key != 'runname'%}
            <div class="row row-space-2 margin-b-4">
             <div class="col-sm-8 col-sm-offset-2">
              <div class="panel panel-default">
                    <div class="panel-heading">Library Kit : for the run name <b>{{ key }} </b></div>
                    <div class="panel-body"> Download the file for Illumina Base Space : 
                        <a href="/polls/documents/{{ values }}" download>{{ values|cut:"BaseSpaceMigrationFiles/" }}<span class="glyphicon glyphicon-download-alt"></span></a>
                        
                    </div> <!--  end of panel body -->
                </div> <!--  end of panel  -->
             </div> <!--  end of col-sm-8 -->
           </div> <!--  end of row -->                
                  
          {%endif%}
        {% endfor %}          
          
          
    {%else %}


    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-8 col-sm-offset-2">
            <p>This FORM will be used to generated the input file that <a href="https://basespace.illumina.com/home/index">BaseSpace</a> requires to execute the run</p>
            <p>.</p>


        </div> <!--// end col-sm-8  -->
    </div> <!--// end row -->
    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-8" >
        <div class="panel panel-default">
          <div class="panel-heading">Form to upload the Sample Sheet file</div>
          <div class="panel-body">
            <form method="post" enctype="multipart/form-data" name="getSample" id="getSample" class="form-horizontal">
            {% csrf_token %}        
                <div class="form-group required">
                  <input type="hidden" name="action" value="uploadFile"/>
                  <label class="col-sm-4 control-label" for="runname" >Fill the Experiment name </label>
                  <div class="col-sm-8"><input class="form-control" type="text" required = "required" name="runname" size="60" maxlength="100"></div>
                </div>
                <div class="form-group required">
                  <label class="col-sm-4 control-label" for="filecsv" >Upload Sample Sheet file </label>
                  <div class="col-sm-8"><input class="form-control" type="file" required = "required" accept ="text/csv" name="myfile"size="80"></div>
                <br>
                <br>
                </div>
                <input class="btn pull-right btn-primary" type="submit" value="Submit">
            </form>
            <p> Fields marked with <FONT COLOR="Red">*</FONT> are mandatory</p>
         </div>  <!--  end of panel body  -->
        </div> <!--// end panel -->
        </div> <!--// end col-sm-8  -->
    </div> <!--// end row -->
    {% endif %}

{% endblock %}
