{% extends 'iSkyLIMS_wetlab/base.html' %}
{% load static %}
{% block content %}

{% if incompatible_samples %}
    {% if incompatible_samples.incompatible_index %}

        <div class="row row-space-4 margin-b-4">
            <div class="col-sm-6 col-sm-offset-3" >
                <div class="panel panel-warning">
                    <div class="panel-heading"><h3>Index not compatible found</h3></div>

                        <div class="panel-body">
                            <p>The selected samples can not be included in the same pool because they are using the same indexes</p>
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Sample Name  </th>
                                        <th>Indexes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for s_name, s_index in incompatible_samples.incompatible_index  %}
                                        <tr>
                                            <td>{{s_name}}</td>
                                            <td>{{s_index}}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <p>Click on the "Return to Select Sample" button to select only one from the ones that are not compatibles </p>
                            <input type="button" value="Return to Select Sample" onclick="location.href ='/wetlab/selectSamplesForRun' ;"/>
                        </div> <!--  end of panel body -->
                    </div> <!--  end of panel  -->

                </div> <!--  end of col-sm-6 -->
            </div> <!--  end of row -->
    {% endif %}
    {% if incompatible_samples.incompatible_s_p_end %}

        <div class="row row-space-4 margin-b-4">
            <div class="col-sm-6 col-sm-offset-3" >
                <div class="panel panel-warning">
                    <div class="panel-heading"><h3>Index not compatible found</h3></div>

                        <div class="panel-body">
                            <p>The selected samples can not be included in the same pool because they have different "Single Read" / Paired End Values</p>
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Sample Name  </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for s_name in incompatible_samples.incompatible_s_p_end  %}
                                        <tr>
                                            <td>{{s_name}}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            <p>Click on the "Return to Select Sample" button to select only one from the ones that are not compatibles </p>
                            <input type="button" value="Return to Select Sample" onclick="location.href ='/wetlab/selectSamplesForRun' ;"/>
                        </div> <!--  end of panel body -->
                    </div> <!--  end of panel  -->

                </div> <!--  end of col-sm-6 -->
            </div> <!--  end of row -->
    {% endif %}
{% elif information_for_selected_run %}
    <script src="{% static "iSkyLIMS_wetlab/js/jquery/v3.4.1/jquery-3.4.1.min.js" %}" type="text/javascript"></script>
    <script src="{% static "iSkyLIMS_wetlab/js/jexcel/v3/jexcel.js" %}" type="text/javascript"></script>
    <script src="{% static "iSkyLIMS_wetlab/js/jsuites/v2/jsuites.js" %}" type="text/javascript"></script>

    <link href="{% static "iSkyLIMS_wetlab/css/jexcel/v3/jexcel.css" %}" rel="stylesheet">
    <link href="{% static "iSkyLIMS_wetlab/css/jsuites/v2/jsuites.css" %}" rel="stylesheet">
    <style>
        .scrolling-wrapper {
     overflow-x: scroll;
     white-space: nowrap;
    }
    </style>
    <div class="row row-space-4 margin-b-4">
        <div class="col-sm-10 col-sm-offset-1" >
            <div class="panel panel-default">
                <div class="panel-heading"><h3>Fill the information to create the Pool </h3></div>
                    <div class="panel-body">
                        <form method="post" enctype="multipart/form-data" name="createRun"  id="createRun" class="form-horizontal well">
                            {% csrf_token %}
                            <div class="scrolling-wrapper">
                                <input type="hidden" name="action" value="createRun"/>
                                <input type="hidden" name="lib_prep_id" value="{{information_for_selected_run.lib_prep_id}}"/>
                                <div class="form-group required">
                                    <label class="col-sm-5 control-label">Define the Experiment Name for the Run</label>
                                    <div class="col-sm-5"><input class="form-control" required = "required" type="text"  name="experimentName" size="80"></div>
                                    <br><br>

                                </div>
                                <div class="form-group ">
                                    <label class="col-sm-5 control-label">Define the Plate</label>
                                    <div class="col-sm-5"><input class="form-control" type="text"  name="plateName" size="80"></div>
                                    <br><br><br>
                                    <label class="col-sm-5 control-label">Define the ContainerID</label>
                                    <div class="col-sm-5"><input class="form-control"  type="text"  name="containerID" size="80"></div>
                                </div>
                                <br><br>
                                <div id="spreadsheet"></div>


                                <script>
                                    var data = [{% for values in information_for_selected_run.data %}
                                        [{% for value in values %}'{{value}}',{% endfor %}],{% endfor %}
                                    ];
                                    mySpreadsheet = $('#spreadsheet').jexcel({
                                        data:data,
                                        columns: [
                                            { type: 'text', title:'{{information_for_selected_run.heading.0}}', width:180 , readOnly:true },
                                            { type: 'text', title:'{{information_for_selected_run.heading.1}}', width:180 , readOnly:true },
                                            { type: 'text', title:'{{information_for_selected_run.heading.2}}', width:80 },
                                            { type: 'text', title:'{{information_for_selected_run.heading.3}}', width:80 },
                                            { type: 'text', title:'{{information_for_selected_run.heading.4}}', width:100 },
                                            { type: 'text', title:'{{information_for_selected_run.heading.5}}', width:80 },
                                            { type: 'text', title:'{{information_for_selected_run.heading.6}}', width:100 },
                                            { type: 'text', title:'{{information_for_selected_run.heading.7}}', width:100 },
                                            { type: 'dropdown', title:'{{information_for_selected_run.heading.8}}', width:150 ,
                                                    source: [{% for value in information_for_selected_run.base_space_library %} "{{value}}", {% endfor %}]},
                                            { type: 'text', title:'{{information_for_selected_run.heading.9}}', width:250 },
                                            { type: 'text', title:'{{information_for_selected_run.heading.10}}', width:80 },

                                        ],
                                        allowInsertColumn:false,
                                        allowDeleteColumn:false,
                                        allowRenameColumn:false,
                                        allowInsertRow:false,
                                        allowDeleteRow:false,
                                        tableOverflow:true,
                                        tableHeight:'200px',
                                        csvFileName:'pool_creation',

                                    });
                                </script>
                                </div> <!--  end of scrolling  -->
                                <br><br>
                                <input type="button" value="Return to Select Sample" onclick="location.href ='/wetlab/selectSamplesForRun' ;"/>
                                <input class="btn pull-right btn-primary" type="submit" id = "btnSubmit" value="Submit">

                         </form>
                         <script>
                             $(document).ready(function () {
                                 $("#createRun").submit(function (e) {
                                     //stop submitting the form to see the disabled button effect
                                     // e.preventDefault();
                                     //disable the submit button
                                     var table_data = $('#spreadsheet').jexcel('getData')
                                     var data_json = JSON.stringify(table_data)
                                     $("<input />").attr("type", "hidden")
                                       .attr("name", "pool_data")
                                       .attr("value", data_json)
                                       .appendTo("#createRun");
                                     $("#btnSubmit").attr("disabled", true);
                                     return true;
                                 });
                             });
                         </script>
                     </div> <!--  end of panel body -->
                 </div> <!--  end of panel  -->

             </div> <!--  end of col-sm-12 -->
         </div> <!--  end of row -->

{% else %}
    <script src="{% static "iSkyLIMS_wetlab/js/jquery/v3.4.1/jquery-3.4.1.min.js" %}" type="text/javascript"></script>
    <script src="{% static "iSkyLIMS_wetlab/js/jexcel/v3/jexcel.js" %}" type="text/javascript"></script>
    <script src="{% static "iSkyLIMS_wetlab/js/jsuites/v2/jsuites.js" %}" type="text/javascript"></script>

    <link href="{% static "iSkyLIMS_wetlab/css/jexcel/v3/jexcel.css" %}" rel="stylesheet">
    <link href="{% static "iSkyLIMS_wetlab/css/jsuites/v2/jsuites.css" %}" rel="stylesheet">
    <div class="row row-space-4 margin-b-4">
        <div class="col-sm-10 col-sm-offset-1" >
            <div class="panel panel-default">
                <div class="panel-heading"><h3>The following Samples are ready to be included inside a Run</h3></div>

                    <div class="panel-body">

                        <form method="post" enctype="multipart/form-data" name="continueWithPool"  id="continueWithPool" class="form-horizontal well">
                        {% csrf_token %}
                            <input type="hidden" name="action" value="continueWithPool"/>
                            <input type="hidden" name="lib_prep_in_list" value="True"/>
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        {% for value in display_list.heading %}
                                            <th> {{ value }}</th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>

                                    {% for lib_code, s_name, c_kit, index7, index5 ,  lib_id in display_list.data  %}
                                        <tr>

                                                <td>{{lib_code}}</td>
                                                <td>{{s_name}}</td>
                                                <td>{{c_kit}}</td>
                                                <td>{{index7}}</td>
                                                <td>{{index5}}</td>
                                                <td><input type="checkbox" name="lib_prep_id" value="{{lib_id}}"></td>

                                        </tr>
                                    {% endfor %}

                                </tbody>
                            </table>
                            <br><br>
                            <input type="button" value="Return Home" onclick="location.href ='/wetlab' ;"/>
                            <input class="btn pull-right btn-primary" type="submit" value="Submit">
                         </form>

                    </div>  <!--  end of panel body  -->

            </div> <!--// end panel -->
        </div> <!--// end col-sm-7  -->
    </div> <!--// end row -->
{% endif %}
{% endblock %}
