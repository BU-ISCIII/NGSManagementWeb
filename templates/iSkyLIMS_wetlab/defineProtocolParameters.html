{% extends 'iSkyLIMS_wetlab/base.html' %}
{% load static %}
{% block content %}
{% csrf_token %}


<div class="row row-space-4 margin-b-4">
    <div class="col-sm-12" >

        <div class="panel panel-default">
            <div class="panel-heading"><h3>Define Protocol Parameter for {{prot_parameters.protocol_name}}</h3></div>
            <div class="panel-body">
                 <form method="post" enctype="multipart/form-data" name="defineProtocolParameters"  id="defineProtocolParameters" class="form-horizontal well">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="define_protocol_parameters"/>
                    <h4>Define the parameters used for Nucleic Acid in protocol {{prot_parameters.protocol_name}}</h4>
                    <div id="spreadsheet1"></div>
                    <br>
                    <br>

                    <input type="button" value="Download Nucleic Acid Parameters" onclick="table1.download()"/>

                    <br><br><br>
                    <h4>Define the parameters used for Libraty preparation in protocol {{prot_parameters.protocol_name}}</h4>
                    <div id="spreadsheet2"></div>

                <br><br>
                <input type="button" value="Download Library preparation Parameters" onclick="table2.download()"/>
                <br>


                <script src="{% static "iSkyLIMS_wetlab/js/jquery/v3.4.1/jquery-3.4.1.min.js" %}" type="text/javascript"></script>
                <script src="{% static "iSkyLIMS_wetlab/js/jexcel/v3/jexcel.js" %}" type="text/javascript"></script>
                <script src="{% static "iSkyLIMS_wetlab/js/jsuites/v2/jsuites.js" %}" type="text/javascript"></script>

                 <link href="{% static "iSkyLIMS_wetlab/css/jexcel/v3/jexcel.css" %}" rel="stylesheet">
                 <link href="{% static "iSkyLIMS_wetlab/css/jsuites/v2/jsuites.css" %}" rel="stylesheet">
                 <br>

                 <script>

                 var data2 = [[],
                 ];
                 var data1 = [[],
                 ];

                 var table1 = jexcel(document.getElementById('spreadsheet1'), {
                     data:data1,
                     columns: [
                         { type: 'text', title:'{{prot_parameters.heading.0}}', width:120 },
                         { type: 'numeric', title:'{{prot_parameters.heading.1}}', width:50 },

                         { type: 'checkbox', title:'{{prot_parameters.heading.2}}', width:50 },
                         { type: 'checkbox' , title: '{{prot_parameters.heading.3}}', width:80 },
                         { type: 'text', title:'{{prot_parameters.heading.4}}', width:90 },
                         { type: 'text', title:'{{prot_parameters.heading.5}}', width:90 },
                         { type: 'text', title:'{{prot_parameters.heading.6}}', width:400 , wordWrap:true },
                     ],
                     allowInsertColumn:false,
                     allowDeleteColumn:false,
                     allowRenameColumn:false,
                     csvFileName:'NA_protocol_parameters',
                     minDimensions:[7,3],
                 });

                 var table2 = jexcel(document.getElementById('spreadsheet2'), {
                     data:data2,
                     columns: [
                         { type: 'text', title:'{{prot_parameters.heading.0}}', width:120 },
                         { type: 'numeric', title:'{{prot_parameters.heading.1}}', width:50, {% if sample_information.sample_names %}  readOnly:true  ,{% endif %} source: [{% for value in sample_information.laboratory %}"{{value}}",{% endfor %}] },

                         { type: 'checkbox', title:'{{prot_parameters.heading.2}}', width:50 {% if sample_information.sample_names %} , readOnly:true  {% endif %}},
                         { type: 'checkbox' , title: '{{prot_parameters.heading.3}}', width:60 },
                         { type: 'text', title:'{{prot_parameters.heading.4}}', width:60 },
                         { type: 'text', title:'{{prot_parameters.heading.5}}', width:60 },
                         { type: 'text', title:'{{prot_parameters.heading.6}}', width:300 , wordWrap:true },
                     ],
                     allowInsertColumn:false,
                     allowDeleteColumn:false,
                     allowRenameColumn:false,
                     csvFileName:'Libraty_protocol_parameters',
                     minDimensions:[7,3],
                 });
                 </script>
                <input class="btn pull-right btn-primary" type="submit" value="Submit">
                </form>
                <script>
                    $(document).ready(function () {
                        $("#defineProtocolParameters").submit(function (e) {
                            //stop submitting the form to see the disabled button effect
                            //e.preventDefault();
                            //disable the submit button
                            var table_data1 = table1.getData()
                            $("<input />").attr("type", "hidden")
                              .attr("name", "table_data1")
                              .attr("value", table_data1)
                              .appendTo("#defineProtocolParameters");
                            var table_data2 = table2.getData()
                              $("<input />").attr("type", "hidden")
                                .attr("name", "table_data2")
                                .attr("value", table_data2)
                                .appendTo("#defineProtocolParameters");
                            $("#btnSubmit").attr("disabled", true);
                            return true;
                        });
                    });
                </script>
            </div>  <!--  end of panel body  -->
        </div> <!--// end panel -->

    </div> <!--// end col-sm-7  -->

</div> <!--// end row -->





<!-- End of FORM for defining protocol parameters -->

{% endblock %}
